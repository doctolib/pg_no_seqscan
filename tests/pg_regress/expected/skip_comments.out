-- Test ignoring seqscans with skip comments
LOAD 'pg_no_seqscan';
SET pg_no_seqscan.level = ERROR;
CREATE TABLE test_skip AS (SELECT * FROM generate_series(1,10) AS id);
-- Show the plan
EXPLAIN (COSTS OFF)
SELECT * FROM test_skip;
      QUERY PLAN       
-----------------------
 Seq Scan on test_skip
(1 row)

-- This query should fail:
SELECT * FROM test_skip;
ERROR:  A 'Sequential Scan' on test_skip has been detected.
  - Run an EXPLAIN on your query to check the query plan.
  - Make sure the query is compatible with the existing indexes.

Query: SELECT * FROM test_skip;

-- Test with skip comment variations
SELECT * FROM test_skip /* pg_no_seqscan_skip */;
 id 
----
  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
(10 rows)

SELECT * FROM test_skip /* host_name:a-b-1.2.foo,db:my_database,git:0123456789abcdef,pg_no_seqscan_skip,path:/foo/source.java:108`(<>)' */;
 id 
----
  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
(10 rows)

SELECT * FROM test_skip /*pg_no_seqscan_skip*/;
 id 
----
  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
(10 rows)

-- Cleanup
DROP TABLE test_skip;
