-- Test UPDATE with subquery
CREATE TABLE upd_foo (id bigint, value text);
CREATE TABLE upd_bar (id bigint, value text);
INSERT INTO upd_foo SELECT i, 'foo' || i FROM generate_series(1, 10) i;
INSERT INTO upd_bar SELECT i, 'bar' || i FROM generate_series(1, 10) i;
-- Test UPDATE with subquery
EXPLAIN (COSTS OFF) UPDATE upd_foo SET value = (SELECT value FROM upd_bar WHERE upd_bar.id = upd_foo.id);
                QUERY PLAN                 
-------------------------------------------
 Update on upd_foo
   ->  Seq Scan on upd_foo
         SubPlan 1
           ->  Seq Scan on upd_bar
                 Filter: (id = upd_foo.id)
(5 rows)

UPDATE upd_foo SET value = (SELECT value FROM upd_bar WHERE upd_bar.id = upd_foo.id);
ERROR:  A 'Sequential Scan' on upd_foo,upd_bar has been detected.
  - Run an EXPLAIN on your query to check the query plan.
  - Make sure the query is compatible with the existing indexes.

Query: UPDATE upd_foo SET value = (SELECT value FROM upd_bar WHERE upd_bar.id = upd_foo.id);

-- Cleanup
DROP TABLE upd_foo, upd_bar;
